---
  - name: Kubernetes | Common Tasks
    include_tasks: common.yml

  - name: Kubernetes | Check Root Cluster
    stat:
      path: /etc/kubernetes/kubeadm-config-root.yml
    register: root_check

  - name: Kubernetes | Root Cluster
    include_tasks: root-cluster.yml
    when:
      - "'root_cluster' in group_names"
      - root_check.stat.exists == False

  - name: Kubernetes | Wait for Cluster (3 Minutes)
    pause:
      minutes: 3

  - name: Kubernetes | Check Second Cluster
    stat:
      path: /etc/kubernetes/kubeadm-config-second.yml
    register: cluster_check
    when: "'second_cluster' in group_names"

  - name: Kubernetes | Second Cluster
    include_tasks: second-cluster.yml
    when:
      - "'second_cluster' in group_names"
      - cluster_check.stat.exists == False
