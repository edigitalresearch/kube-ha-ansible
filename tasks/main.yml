---
  - name: Kubernetes | Disable SELINUX
    hosts: all
    shell: setenforce 0

  - name: Kubernetes | Update SELinux (Disable on Boot)
    hosts: all
    replace:
      path: /etc/selinux/config
      regexp: 'SELINUX=enforcing'
      replace: 'SELINUX=disabled'

  - name: Kubernetes | Add Repos
    hosts: all
    yum_repository:
      name: Kubernetes
      description: Kubernetes Repos
      baseurl: https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
      gpgcheck: no
      repo_gpgcheck: no

  - name: Kubernetes | Install Packages
    hosts: all
    yum:
      name: "{{ item }}"
      state: present
    with_items: "{{ kubernetes.packages }}"

  - name: Kubernetes | Enable Services
    hosts: all
    systemd:
      state: started
      enabled: True
      name: "{{ item }}"
    with_items:
      - docker
      - kubelet
