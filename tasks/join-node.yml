- name: Kubernetes | Generate Join Token
  shell: kubeadm token create --print-join-command
  register: join_tokens
  when: "'root_cluster' in group_names"
  with_sequence: start=1 end="{{ groups['kube_workers'] | length }}"
  tags:
    - scale

- name: Kubernetes | Join Worker Node
  command: "{{ hostvars[groups['root_cluster'][0]]['join_tokens']['results'][groups['kube_workers'].index(inventory_hostname)]['stdout'] }}"
  when: "'kube_workers' in group_names"
  tags:
    - scale
