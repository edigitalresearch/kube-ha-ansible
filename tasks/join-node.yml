- name: Kubernetes | Generate Join Token
  shell: kubeadm token generate
  register: join_tokens
  when: "'root_cluster' in group_names"
  with_sequence: start=1 end="{{ groups['kube_workers'] | length }}"
  tags:
    - scale

# - name: DEBUG | ALL
#   debug:
#     msg: "{{ join_tokens }}"
#   tags:
#     - scale

- name: DEBUG
  debug:
    msg: "{{ item }}"
  when: "'stdout_lines' in item.value"
  with_dict: "{{ join_tokens }}"
  tags:
    - scale

# - name: DEBUG
#   debug:
#     msg: "{{ item }}"
#   with_items: "{{ join_tokens.results }}"
#   tags:
#     - scale

# - name: Kubernetes | Join Worker Node
#   command: "kubeadm join {{ kubernetes.load_balancer.dns }}:{{ kubernetes.load_balancer.port }} --token {{ item.value.results.stdout_lines[0] }} --discovery-token-unsafe-skip-ca-verification"
#   when: "'kube_workers' in group_names"
#   with_items: "{{ join_tokens.results }}"
